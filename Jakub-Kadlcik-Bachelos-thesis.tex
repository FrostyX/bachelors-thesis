\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[czech]{babel}
\usepackage[T1]{fontenc}

\usepackage{verbatim}
\usepackage{listings}
\usepackage{color}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage{url}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstdefinestyle{sources}
{%
	backgroundcolor=\color{white},   % Pozadí
	commentstyle=\color{mygreen},    % Komentáře
	keywordstyle=\color{blue},       % Klíčová slova jazyka
	stringstyle=\color{mymauve},     % Řetězce
}

\lstset
{%
	%
	% Základní nastavení
	%
	basicstyle=\footnotesize,        % Styl a typ písma
	captionpos=b,                    % Pozice popisku
	showstringspaces=false,          % Když true, místo mezer se vypíše podtržítko. e.g. "Hello_world"
	title=\lstname,                  % Při výpisu zdrojového kódu ze souboru, nastaví název souboru jako popisek
	tabsize=4,                       % Velikost tabulátoru (počet mezer)
	style=sources,
	%
	% Podpora českých znaků
	% http://tex.stackexchange.com/questions/30512/how-to-insert-code-with-accents-with-listings/85947#85947
	%
	literate=
		{á}{{\'a}}1     {í}{{\'i}}1     {é}{{\'e}}1
		{ý}{{\'y}}1     {ú}{{\'u}}1     {ó}{{\'o}}1
		{ě}{{\v{e}}}1   {š}{{\v{s}}}1   {č}{{\v{c}}}1
		{ř}{{\v{r}}}1   {ž}{{\v{z}}}1   {ď}{{\v{d}}}1
		{ť}{{\v{t}}}1   {ň}{{\v{n}}}1   {ů}{{\r{u}}}1
		{Á}{{\'A}}1     {Í}{{\'I}}1     {É}{{\'E}}1
		{Ý}{{\'Y}}1     {Ú}{{\'U}}1     {Ó}{{\'O}}1
		{Ě}{{\v{E}}}1   {Š}{{\v{S}}}1   {Č}{{\v{C}}}1
		{Ř}{{\v{R}}}1   {Ž}{{\v{Z}}}1   {Ď}{{\v{D}}}1
		{Ť}{{\v{T}}}1   {Ň}{{\v{N}}}1   {Ů}{{\r{U}}}1
	,
}

\title{Determine applications affected by upgrade}
\author{Jakub Kadlčík}

\begin{document}
	% Vazba
	\maketitle
	\newpage

	% Anotace

	% Poděkování

	\tableofcontents
	\newpage

	\section{Úvod}
		\subsection{Správa software v GNU/Linux}
		Ve většině distribucí GNU/Linuxu se software standardně spravuje prostřednictvím balíčkovacího systému. Nové distribuce většinou vznikají odvozením jiné, již existující distribuce a v tomto případě bývá zachován typ balíčků i balíčkovací systém. Můžeme tedy říct, že distribucí je mnoho, ale balíčkovaích systémů se používá jen velmi málo. Konkrétně lze hovořit o distribucích GNU/Linuxu používající balíčky RPM\footnote{RPM = Red Hat Package Manager}, DEB\footnote{DEB = Debian software package} a nebo jiný typ balíčku. V posledním případě se jedná případ od případu o velmi specifický předpis balíčku. V rámci této práce se budeme zabývat linuxovou distribucí Fedora jako reprezentantem první skupiny a distribucí Gentoo, jako reprezentantem poslední skupiny.

			\subsubsection{Balíčkovací systém distribuce Fedora}
			Fedora vznikla jako nekomerční odnož Red Hat Linuxu a zachovala stávající systém balíčků RPM\@. Od své první verze využívá nástavbu nad RPM zvanou YUM\@. Ten se po čase stal téměř neudržovatelný a proto se objevila alternativa pojmenovaná DNF\@. V současné době lze paralelně využívat oba tyto nástroje, avšak je snaha YUM kompletně nahradit za pomocí DNF\@. Mělo by k tomu dojít již ve Fedoře 21. Aktuální stabilní verze je 20, jde tedy o příští vydání.

			\subsubsection{Balíčkovací systém distribuce Gentoo}

		\subsection{Problém}
		Když spustíme aplikaci, do paměti se načtou knihovny a soubory potřebné k jejímu běhu. Pokud je některá z knihoven, nebo samotná aplikace po dobu jejího běhu aktualizována, v paměti stále zůstanou původní soubory, přestože fyzicky už nemusí existovat (mohou být smazány, nebo nahrazeny novějšími verzemi).
		\\\\
		Zjistit, které, v systému spuštěné, aplikace využívají takto neaktuální soubory, není pro uživatele triviální. V současné době sice existují nástroje, které tento problém řeší, avšak jsou z mnoha důvodů nedostatečné.

		\subsection{Požadavky}
		Tato práce si klade za cíl vytvořit aplikaci, která bude řešit dříve zmíněný problém. Aplikace by měla najít všechny programy využívající neaktuální soubory a doporučit jejich restartování. Pro různé typy programů by měla být vypsána jiná doporučení a nápověda, jakým způsobem to lze provést. Aplikace by měla disponovat textovým uživatelským rozhraním a mělo by být možné ji používat jako modul přímo v balíčkovacím systému DNF\@. Vývoj by měl probíhat pod otevřenou licencí a na libovolném veřejném úložišti. Dále by měl být k dispozici instalační balíček pro distribuci Fedora.

	\section{Analýza}
	Rozložme si problém na menší části a projděme je jednu po druhé. Stěžení částí aplikace má být vypsání jistého seznamu aplikací. Nejdříve se tedy zaměříme na jeho získání. Dále potřebujeme konstrukt, který zjistí informace o  dané aplikaci. Nakonec nás bude zajímat zjištění způsobu, jak aplikaci restartovat.

		\subsection{Získání seznamu ovlivněných aplikací}
		Stěžejní část aplikace. [..] Nabízí se přímočaré řešení. Zjistit seznam balíčků, které byly od spuštění systému modifikovány. Následně pro každý balíček zjistit seznam souborů, které poskytuje. Poté zjistit, které procesy využívají některý z množiny modifikovaných souborů. Tedy pro každý spuštěný proces zjistit seznam souborů jež využívá a najít shodu s modifikovanými balíčky.

		\lstinputlisting
		[
			language={Python},
			label=naive-tracer-algorithm,
			caption={Algoritmus pro vypsání seznamu ovlivněných aplikací}
		]{sources/naive_tracer_algorithm.py}

		Algoritmus na první pohled vypadá velmi jednoduše a zřejmě vypíše korektní množinu procesů. Mohlo by se tedy zdát, že máme hotovo, nicméně jsme nevzali v úvahu časovou složitost takového algoritmu. Ta je bohužel velmi nepříznivá, což by činilo vyhledávání útrpně pomalé.

		% vypočítání složitosti
		% Vysvětlení a ukázka kódu množinového průniku

		Klíčem k rychlejšímu získání chtěných procesů je zvolení vhodné vyhledávací struktury pro data. Vezměme si fakt, že mnoho procesů využívá stejné soubory (knihovny, etc). Naivní algoritmus tedy jeden konkrétní soubor musí ověřit hned několikrát - pro každý proces, který jej využívá.

		Tento nedostatek můžeme řešit tak, že nebudueme zkoumat proces po procesu, ale místo toho vezmeme množinu všech\footnote{} souborů v paměti, přičemž ke každému si poznačíme procesy, které jej využívají. Pro nejrychlejší možné vyhledávání v množině souborů, je budeme ukládat do vyhledávacího stromu typu BTree.

		\lstinputlisting
		[
			language={Python},
			label=tracer-algorithm,
			caption={Vylepšený algoritmus pro vypsání seznamu ovlivněných aplikací}
		]{sources/tracer_algorithm.py}

		% Výpočet složitosti algoritmu

		\subsection{Informace o aplikaci}
		Rozlišujme dva druhy informací. Pracujeme se spuštěnými aplikacemi, v tom případě lze hovořit o procesech spuštěných v systému. Každý proces má nějaký PID\footnote{}, spustil jej nějaký uživatel, běží určitou dobu, etc.

		Dále lze uvažovat, že každá\footnote{Každá standardně nainstalovaná} aplikace je poskytována některým balíčkem. Každý takový balíček poskytuje informace o tom, k čemu slouží, v jaké je verzi, jak dlouho je nainstalován, etc.

		Lze předpokládat, že informace o procesech budou získatelné jednotným způsobem napříč celým spektrem linuxových distribucí, avšak informace o balíčku budou závislé na jeho typu.

		\subsection{Jak aplikaci restartovat?}

	\section{Implementace}
		\subsection{Úvod}
		Projekt je vyvíjen pod názvem tracer. Požadovalo se, aby byl implementován v jazyce Python. V současné době se nejčastěji pouužívá Python2.7, který lze nalézt na všech distribucích a pro který existuje velká spousta uživatelských knihoven. Z tohoto důvodu jsem zvolil právě verzi 2.7, přestože aktuální stabilní verzí je 3.x.

		\subsection{Práce s procesy}
		Správu procesů v jazyce python zajišťuje balík psutil, který je ve Fedoře k dispozici pod názvem python-psutil. Umožňuje přístup ke všem atributům procesu, které lze v linuxových systémech zjistit. Mimo to poskytuje rozhraní pro získávání informací o paměti, procesoru, pevných discích a síťových rozhraních.

		Nás ovšem zajímá pouze práce s procesy.

		\lstinputlisting
		[
			language={Python},
			label=psutil,
			caption={Základní práce s procesy v psutil}
		]{sources/psutil.py}

		Pokročilejší funkcí může být zjištění souborů, které proces využívá.

		\lstinputlisting
		[
			language={Python},
			label=process-files,
			caption={Výpis všech souborů, kter proces využívá}
		]{sources/process_files.py}

		Výpis tohoto ukázkového kódů může vypadat následovně:

		\lstinputlisting
		[
			label=process-files-output,
			caption={Výpis všech souborů, kter proces využívá}
		]{sources/process_files_output}

		\subsection{Práce s balíčky}
			Především nás budou zajímat tři operace. Zjištění seznamu balíčků, které byly od daného času modifikovány, zjištění základních informací o balíčku jako například název, popis, etc a nakonec zjištění souborů, které balíček poskytuje.

			\subsubsection{Historie balíčků}
			Balíčkovacím systémem distribuce Fedora je program zvaný DNF\@. Pro uchovávání historie prováděných operací s balíčky, využívá sqlite databázi v adresáři /var/lib/dnf/history. Z ní se můžeme dozvědět, který balíček byl nainstalován, či odinstalován a kdy.

			% Obrázek databáze

			\subsubsection{Informace o balíčku}
			Pro zjištění všech informací o balíčku můžeme použít příkaz

			% Pozor, balíček musí být nainstalován
			\begin{lstlisting}
				rpm -qi nazev_balicku
			\end{lstlisting}

			Výpis těch zajímavějších můžeme vidět zde
			\lstinputlisting
			[
				label=fedora-package-info-output,
				caption={Informace o balíčku}
			]{sources/fedora_package_info_output}

			Tyto informace můžeme v prostředí Pythonu získat a zpracovat například takto
			\lstinputlisting
			[
				language=Python,
				label=fedora-package-info-parse,
				caption={Parsování informací o balíčku}
			]{sources/fedora_package_info_parse.py}

			\subsubsection{Seznam souborů poskytovaných balíčkem}
			Ke zjištění seznamu všech souborů, které daný balíček poskytuje, máme k dispozici příkaz

			% Pozor, balíček musí být nainstalován
			\begin{lstlisting}
				rpm -ql nazev_balicku
			\end{lstlisting}

			Zpracovat jej v Pythonu můžeme následovně

			\lstinputlisting
			[
				language=Python,
				label=fedora-package-files-parse,
				caption={Parsování souborů poskytovaných balíčkem}
			]{sources/fedora_package_files_parse.py}

		\subsection{Tracer}
			\subsubsection{Adresářová struktura}
			\subsubsection{MVC}

		\subsection{DNF plugin}
		\subsection{Testování}

	\section{Distribuce programu}
		\subsection{Zdrojový kód}
		\subsection{Verzování}
		\subsection{Balíčky pro distribuce}
		\subsection{Dokumentace}
		\subsection{Licence}

	\section{Závěr} % Zrušit číslování
	\section{Conclusions} % Zrušit číslování
	\section{Reference} % Zrušit číslování

	% Obsah přiloženého CD
\end{document}
